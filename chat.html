<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Fitness Factory â€“ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©</title>
  <style>
    :root{
      --bg:#0d0d0d; --card:#121212; --text:#ffffff; --muted:#cfcfcf; --brand:#F5B301;
    }
    *{box-sizing:border-box}
    body{
      margin:0; background:var(--bg); color:var(--text);
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans Arabic", "Tajawal", sans-serif;
      display:flex; min-height:100vh; align-items:center; justify-content:center; padding:16px;
    }
    .wrap{width:100%; max-width:780px}
    .top{
      display:flex; align-items:center; gap:12px; margin-bottom:12px;
    }
    .logo{
      width:42px; height:42px; border-radius:12px; background:#1a1a1a;
      display:grid; place-items:center; border:1px solid #222;
    }
    .loading{opacity:.7;pointer-events:none}
    .logo:before{
      content:"ğŸ‹ï¸"; filter:grayscale(0); font-size:22px;
    }
    .brand h1{margin:0; font-size:20px; color:var(--brand); letter-spacing:.5px}
    .brand p{margin:0; color:var(--muted); font-size:13px}
    .card{
      background:var(--card); border:1px solid #1f1f1f; border-radius:16px; overflow:hidden;
      box-shadow: 0 10px 24px rgba(0,0,0,.35);
    }
    .chat{
      height:60vh; min-height:420px; max-height:70vh; overflow:auto; padding:16px;
      display:flex; flex-direction:column; gap:10px;
      scroll-behavior:smooth;
    }
    .msg{max-width:84%; padding:10px 12px; border-radius:14px; line-height:1.55; font-size:14.5px;}
    .user{align-self:flex-start; background:#1b1b1b; border:1px solid #2a2a2a;}
    .bot{align-self:flex-end; background:var(--brand); color:#1a1a1a; font-weight:600;}
    .input{
      display:flex; gap:8px; padding:12px; border-top:1px solid #1f1f1f; background:#141414;
    }
    input[type="text"]{
      flex:1; background:#0f0f0f; border:1px solid #252525; color:var(--text);
      padding:12px 14px; border-radius:12px; outline:none; font-size:14px;
    }
    button{
      background:var(--brand); color:#000; border:none; padding:12px 16px; border-radius:12px;
      font-weight:700; cursor:pointer; transition:.2s; min-width:110px;
    }
    button:hover{filter:saturate(1.1) brightness(.98)}
    .subtle{color:#9d9d9d; font-size:12px; margin-top:8px}
    .pill{
      display:inline-block; padding:6px 10px; border:1px solid #2a2a2a; border-radius:999px;
      color:#bdbdbd; font-size:12px; margin:0 6px 6px 0; cursor:pointer;
    }
    .pill:hover{border-color:#3a3a3a; color:#fff}
    .msg {
  white-space: pre-wrap;
  overflow-wrap: anywhere;
  word-break: break-word;
  line-height: 1.6;
}

.msg a {
  color: #f5b301;
  font-weight: 600;
  text-decoration: underline;
  transition: 0.2s ease;
  cursor: pointer;
}
.msg a:hover {
  opacity: .9;
  text-decoration: none;
}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div class="logo"></div>
      <div class="brand">
        <h1>Fitness Factory â€“ Ø§Ù„Ù…Ø¯Ø±Ø¨ Ø§Ù„Ø°ÙƒÙŠ</h1>
        <p>Ù†Ø³Ø®Ø© ÙˆØ§Ø¬Ù‡Ø© ÙÙ‚Ø· (ØªØ¬Ø±ÙŠØ¨ÙŠØ©). Ø§Ù„Ø±Ø¨Ø· Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„ØµÙ†Ø§Ø¹ÙŠ ÙŠØªÙ… ÙÙŠ Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©.</p>
      </div>
    </div>

    <div class="card">
      <div id="chat" class="chat">
        <div class="msg bot">Ù‡Ù„Ø§ ÙÙŠÙƒ! Ø£Ù†Ø§ Ù…Ø¯Ø±Ø¨Ùƒ Ø§Ù„Ø°ÙƒÙŠ ÙÙŠ Fitness Factory ğŸ’ª
        Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ø¹Ù† Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ†ØŒ Ø§Ù„Ø¨Ø¯Ø§Ø¦Ù„ØŒ Ø£Ùˆ Ø§Ù„Ø³Ø¹Ø±Ø§Øª. (Ù†Ø³Ø®Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©)</div>
      </div>

      <div style="padding:10px 12px;">
        <span class="pill" onclick="quick('Ø£Ø¨ÙŠ Ø¨Ø¯ÙŠÙ„ Ù„Ø³ÙƒÙˆØ§Øª Ù„Ø£Ù† Ø±ÙƒØ¨ØªÙŠ ØªØ¹ÙˆØ±Ù†ÙŠ')">Ø¨Ø¯ÙŠÙ„ Ø³ÙƒÙˆØ§Øª</span>
        <span class="pill" onclick="quick('Ø£Ø¨ÙŠ Ø¬Ø¯ÙˆÙ„ Ù„Ù„ØµØ¯Ø± Ù„Ù„Ù…Ø¨ØªØ¯Ø¦ÙŠÙ†')">ØµØ¯Ø± Ù…Ø¨ØªØ¯Ø¦</span>
        <span class="pill" onclick="quick('ÙƒÙ… Ø£Ø­ØªØ§Ø¬ Ø¨Ø±ÙˆØªÙŠÙ† ÙˆØ²Ù† 80 ÙˆØ·ÙˆÙ„ 175')">Ø­Ø³Ø§Ø¨ Ø¨Ø±ÙˆØªÙŠÙ†</span>
      </div>

      <div class="input">
        <input id="q" type="text" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ù‡Ù†Ø§â€¦" />
        <button id="send" type="button">Ø¥Ø±Ø³Ø§Ù„</button>

      </div>
    </div>
    <div class="subtle">Ù…Ù„Ø§Ø­Ø¸Ø©: Ù‡Ø°Ù‡ Ù†Ø³Ø®Ø© Ù„Ù„ÙˆØ§Ø¬Ù‡Ø© ÙÙ‚Ø·. Ù‚Ø±ÙŠØ¨Ø§Ù‹ Ù†Ø±Ø¨Ø·Ù‡Ø§ Ø¨Ù€ API.</div>
  </div>
<script>
// Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
const chat = document.getElementById('chat');
const q = document.getElementById('q');
const send = document.getElementById('send');

// Ø¯Ø§Ù„Ø© Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø³Ø±ÙŠØ¹Ø©
function quick(text) {
  q.value = text;
  q.focus();
}
</script>

<script>
  // ØªÙ‡Ø±ÙŠØ¨ HTML (Ø£Ù…Ø§Ù†)
  function escapeHTML(s) {
    return s.replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
  }

  // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ù„Ù†Øµ Ù‚Ø§Ø¨Ù„ Ù„Ù„Ù†Ù‚Ø± (ÙŠØ¯Ø¹Ù… http/https Ùˆ Markdown [Ù†Øµ](Ø±Ø§Ø¨Ø·))
  function linkify(html) {
    // [Ù†Øµ](Ø±Ø§Ø¨Ø·)
    html = html.replace(/\[([^\]]+)\]\((https?:\/\/[^\s)]+)\)/g,
      '<a href="$2" target="_blank" rel="noopener noreferrer">$1</a>');

    // Ø±Ø§Ø¨Ø· Ø¹Ø§Ø¯ÙŠ
    html = html.replace(/(https?:\/\/[^\s<>()]+)(?=\s|$)/g,
      '<a href="$1" target="_blank" rel="noopener noreferrer">$1</a>');

    return html;
  }

  // Ø§Ø³ØªØ®Ø¯Ù… Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø© Ù„Ø¥Ø¶Ø§ÙØ© ÙÙ‚Ø§Ø¹Ø© Ø±Ø³Ø§Ù„Ø©
  function addMessage(role, text) {
  const chat = document.querySelector('.chat');
  const msg = document.createElement('div');
  msg.className = role === 'user' ? 'msg user' : 'msg bot';

  msg.innerHTML = linkify(escapeHTML(text)); // â† Ù‡Ø°Ø§ Ø§Ù„Ø³Ø·Ø± Ù‡Ùˆ Ø§Ù„Ù…Ù‡Ù…

  chat.appendChild(msg);
  chat.scrollTop = chat.scrollHeight;
}
  }
</script>
<script>
// ------------- Ø£Ø¯ÙˆØ§Øª Ø¨Ø³ÙŠØ·Ø© -------------
function escapeHTML(s){
  return s.replace(/[&<>'"]/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;',"'":'&#39;','"':'&quot;'}[m]));
}

// ØªØ­ÙˆÙŠÙ„ Ø£ÙŠ Ø±Ø§Ø¨Ø· Ù„Ù†Øµ Ù‚Ø§Ø¨Ù„ Ù„Ù„Ù†Ù‚Ø± ÙŠÙØªØ­ ÙÙŠ ØªØ¨ÙˆÙŠØ¨ Ø¬Ø¯ÙŠØ¯
function linkify(html){
  // ØµÙŠØºØªØ§Ù†: [Ù†Øµ](https://..)  Ùˆ  https://..
  html = html.replace(/\[([^\]]+)\]\(((https?:\/\/[^\s)]+))\)/g,
    `<a href="$2" target="_blank" rel="noopener noreferrer">$1</a>`);
  html = html.replace(/(https?:\/\/[^\s<]+)/g,
    `<a href="$1" target="_blank" rel="noopener noreferrer">$1</a>`);
  return html;
}

// ------------- Ù…Ø±Ø§Ø¬Ø¹ Ø§Ù„Ø¹Ù†Ø§ØµØ± -------------
const chat = document.getElementById('chat');
const q    = document.getElementById('q');
const send = document.getElementById('send');

// ------------- Ø·Ø¨Ø§Ø¹Ø© Ø±Ø³Ø§Ù„Ø© -------------
function addMessage(role, text){
  const msg = document.createElement('div');
  msg.className = role === 'user' ? 'msg user' : 'msg bot';
  msg.innerHTML = linkify(escapeHTML(text));
  chat.appendChild(msg);
  chat.scrollTop = chat.scrollHeight;
}

// ------------- Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ù„Ù€ /api/chat -------------
async function handleSend(){
  const text = q.value.trim();
  if (!text) return;

  // Ø§Ø·Ø¨Ø¹ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
  addMessage('user', text);
  q.value = '';

  // Ù„Ùˆ Ø¹Ø§Ù„Ù‚ Ø§ØªØµØ§Ù„/Ø²Ø± Ù…Ø¶ØºÙˆØ· â€” Ù†Ù…Ù†Ø¹ ØªØ¹Ø¯Ø¯ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
  if (send.classList.contains('loading')) return;
  send.classList.add('loading');

  try{
    const r = await fetch('/api/chat', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({ message: text })
    });

    if (!r.ok){
      // Ø­Ø§ÙˆÙ„ Ù†Ù‚Ø±Ø£ Ø®Ø·Ø£ Ø§Ù„Ø³ÙŠØ±ÙØ±
      let err = `ØªØ¹Ø°Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ (HTTP ${r.status})`;
      try{
        const d = await r.json();
        if (d && d.error) err = d.error;
      }catch{}
      addMessage('bot', `âš ï¸ Ù…Ø§ Ù‚Ø¯Ø±Øª Ø£Ø¬ÙŠØ¨ Ø±Ø¯ Ø§Ù„Ø¢Ù†.\n${err}`);
      return;
    }

    const data = await r.json();
    addMessage('bot', data.reply || 'âš ï¸ Ù…Ø§ Ù„Ù‚ÙŠØª Ø±Ø¯ Ù…Ù†Ø§Ø³Ø¨ Ø§Ù„Ø¢Ù†');

  }catch(e){
    console.error(e);
    addMessage('bot', 'âš ï¸ ØµØ§Ø± Ø®Ù„Ù„ Ø¨Ø³ÙŠØ· Ø¨Ø§Ù„Ø§ØªØµØ§Ù„. Ø¬Ø±Ù‘Ø¨ Ø«Ø§Ù†ÙŠØ© ğŸ™');
  }finally{
    send.classList.remove('loading');
    q.focus();
  }
}

// ------------- Ø±Ø¨Ø· Ø§Ù„Ø£Ø­Ø¯Ø§Ø« -------------
function bindEvents(){
  if (!send || !q) return;

  // Ø²Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
  send.addEventListener('click', (e)=>{
    e.preventDefault();
    handleSend();
  }, { passive:false });

  // Ø¥Ù†ØªØ± Ù…Ù† Ø­Ù‚Ù„ Ø§Ù„Ù†Øµ
  q.addEventListener('keydown', (e)=>{
    if (e.key === 'Enter'){
      e.preventDefault();
      handleSend();
    }
  }, { passive:false });
}

// Ø§Ø±Ø¨Ø· Ø¨Ø¹Ø¯ Ø¬Ø§Ù‡Ø²ÙŠØ© Ø§Ù„ØµÙØ­Ø©
if (document.readyState === 'loading'){
  document.addEventListener('DOMContentLoaded', bindEvents);
}else{
  bindEvents();
}
</script>
</body>
</html>









